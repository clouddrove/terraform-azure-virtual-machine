<!-- This file was automatically generated by the `geine`. Make all changes to `README.yaml` and run `make readme` to rebuild this file. -->

<p align="center"> <img src="https://user-images.githubusercontent.com/50652676/62349836-882fef80-b51e-11e9-99e3-7b974309c7e3.png" width="100" height="100"></p>


<h1 align="center">
    Terraform AZURE VIRTUAL MACHINE
</h1>

<p align="center" style="font-size: 1.2rem;"> 
    Terraform module to create virtual machine resource on AZURE.
     </p>

<p align="center">

<a href="https://www.terraform.io">
  <img src="https://img.shields.io/badge/Terraform-v1.1.7-green" alt="Terraform">
</a>
<a href="LICENSE.md">
  <img src="https://img.shields.io/badge/License-APACHE-blue.svg" alt="Licence">
</a>


</p>
<p align="center">

<a href='https://facebook.com/sharer/sharer.php?u=https://github.com/clouddrove/terraform-azure-virtual-machine'>
  <img title="Share on Facebook" src="https://user-images.githubusercontent.com/50652676/62817743-4f64cb80-bb59-11e9-90c7-b057252ded50.png" />
</a>
<a href='https://www.linkedin.com/shareArticle?mini=true&title=Terraform+AZURE+VIRTUAL+MACHINE&url=https://github.com/clouddrove/terraform-azure-virtual-machine'>
  <img title="Share on LinkedIn" src="https://user-images.githubusercontent.com/50652676/62817742-4e339e80-bb59-11e9-87b9-a1f68cae1049.png" />
</a>
<a href='https://twitter.com/intent/tweet/?text=Terraform+AZURE+VIRTUAL+MACHINE&url=https://github.com/clouddrove/terraform-azure-virtual-machine'>
  <img title="Share on Twitter" src="https://user-images.githubusercontent.com/50652676/62817740-4c69db00-bb59-11e9-8a79-3580fbbf6d5c.png" />
</a>

</p>
<hr>


We eat, drink, sleep and most importantly love **DevOps**. We are working towards strategies for standardizing architecture while ensuring security for the infrastructure. We are strong believer of the philosophy <b>Bigger problems are always solved by breaking them into smaller manageable problems</b>. Resonating with microservices architecture, it is considered best-practice to run database, cluster, storage in smaller <b>connected yet manageable pieces</b> within the infrastructure. 

This module is basically combination of [Terraform open source](https://www.terraform.io/) and includes automatation tests and examples. It also helps to create and improve your infrastructure with minimalistic code instead of maintaining the whole infrastructure code yourself.

We have [*fifty plus terraform modules*][terraform_modules]. A few of them are comepleted and are available for open source usage while a few others are in progress.




## Prerequisites

This module has a few dependencies: 

- [Terraform 1.x.x](https://learn.hashicorp.com/terraform/getting-started/install.html)
- [Go](https://golang.org/doc/install)
- [github.com/stretchr/testify/assert](https://github.com/stretchr/testify)
- [github.com/gruntwork-io/terratest/modules/terraform](https://github.com/gruntwork-io/terratest)







## Examples


**IMPORTANT:** Since the `master` branch used in `source` varies based on new modifications, we suggest that you use the release versions [here](https://github.com/clouddrove/terraform-azure-virtual-machine/releases).


Here are some examples of how you can use this module in your inventory structure:
### Default vnet-peering
```hcl
  module "virtual-machine" {
  source                         = "clouddrove/virtual-machine/azure"
  version                        = "1.0.0"
  name                           = "app"
  environment                    = "test"
  label_order                    = ["name", "environment"]
  ## Common
  enabled                        = true
  machine_count                  = 1
  resource_group_name            = module.resource_group.resource_group_name
  location                       = module.resource_group.resource_group_location

  ## Network Interface
  subnet_id                      = module.subnet.default_subnet_id
  private_ip_address_version     = "IPv4"
  private_ip_address_allocation  = "Static"
  primary                        = true
  private_ip_addresses           = ["10.0.1.4"]
  #nsg
  network_interface_sg_enabled   = true
  network_security_group_id      = module.security_group.id

  ## Availability Set
  availability_set_enabled       = true
  platform_update_domain_count   = 7
  platform_fault_domain_count    = 3

  ## Public IP
  public_ip_enabled              = true
  sku                            = "Basic"
  allocation_method              = "Static"
  ip_version                     = "IPv4"

  ## Virtual Machine
  linux_enabled                  = true
  vm_size                        = "Standard_B1s"
  file_path                      = "~/.ssh/id_rsa.pub"
  username                       = "ubuntu"
  os_profile_enabled             = true
  admin_username                 = "ubuntu"
  create_option                  = "FromImage"
  caching                        = "ReadWrite"
  disk_size_gb                   = 30
  os_type                        = "Linux"
  managed_disk_type               = "Standard_LRS"
  storage_image_reference_enabled = true
  image_publisher                 = "Canonical"
  image_offer                     = "UbuntuServer"
  image_sku                       = "20.04-LTS"
  image_version                   = "latest"
}
```






## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| access\_tier | Defines the access tier for BlobStorage, FileStorage and StorageV2 accounts. Valid options are Hot and Cool, defaults to Hot. | `string` | `"Hot"` | no |
| account\_kind | Defines the Kind of account. Valid options are BlobStorage, BlockBlobStorage, FileStorage, Storage and StorageV2. | `string` | `"StorageV2"` | no |
| account\_replication\_type | Defines the type of replication to use for this storage account. Valid options are LRS, GRS, RAGRS, ZRS, GZRS and RAGZRS. | `string` | `""` | no |
| account\_tier | Defines the Tier to use for this storage account. Valid options are Standard and Premium. | `string` | `""` | no |
| addtional\_capabilities\_enabled | Whether additional capabilities block is enabled. | `bool` | `false` | no |
| admin\_password | The password associated with the local administrator account. | `string` | `""` | no |
| admin\_username | Specifies the name of the local administrator account. | `string` | `""` | no |
| allocation\_method | Defines the allocation method for this IP address. Possible values are Static or Dynamic. | `string` | `""` | no |
| allowed\_headers | A list of headers that are allowed to be a part of the cross-origin request. | `list(any)` | `[]` | no |
| allowed\_methods | A list of http headers that are allowed to be executed by the origin. Valid options are DELETE, GET, HEAD, MERGE, POST, OPTIONS, PUT or PATCH. | `list(any)` | `[]` | no |
| allowed\_origins | A list of origin domains that will be allowed by CORS. | `list(any)` | `[]` | no |
| application | Application (e.g. `cd` or `clouddrove`). | `string` | `""` | no |
| availability\_set\_enabled | Whether availability set is enabled. | `bool` | `false` | no |
| blob\_endpoint | The Storage Account's Blob Endpoint which should hold the virtual machine's diagnostic files | `string` | `""` | no |
| blob\_properties\_enabled | Is blob properties is enabled. | `bool` | `false` | no |
| boot\_diagnostics\_enabled | Whether boot diagnostics block is enabled. | `bool` | `false` | no |
| bypass | Specifies whether traffic is bypassed for Logging/Metrics/AzureServices. Valid options are any combination of Logging, Metrics, AzureServices, or None. | `string` | `""` | no |
| caching | Specifies the caching requirements for the OS Disk. Possible values include None, ReadOnly and ReadWrite. | `string` | `""` | no |
| certificate\_store | Specifies the certificate store on the Virtual Machine where the certificate should be added to, such as My. | `string` | `""` | no |
| certificate\_url | The ID of the Key Vault Secret which contains the encrypted Certificate which should be installed on the Virtual Machine. This certificate must also be specified in the vault\_certificates block within the os\_profile\_secrets block. | `string` | `""` | no |
| component | Specifies the name of the component to configure with the added content. The only allowable value is Microsoft-Windows-Shell-Setup. | `string` | `"Microsoft-Windows-Shell-Setup"` | no |
| content | Specifies the base-64 encoded XML formatted content that is added to the unattend.xml file for the specified path and component. | `string` | `""` | no |
| create | Used when creating the Resource Group. | `string` | `"60m"` | no |
| create\_option | Specifies how the OS Disk should be created. Possible values are Attach (managed disks only) and FromImage. | `string` | `""` | no |
| custom\_domain\_enabled | Whether custom domain is enabled. | `bool` | `false` | no |
| custom\_image\_id | Specifies the ID of the Custom Image which the Virtual Machine should be created from. | `string` | `""` | no |
| days | Specifies the number of days that the blob should be retained, between 1 and 365 days. Defaults to 7. | `number` | `7` | no |
| ddos\_protection\_mode | The DDoS protection mode of the public IP | `string` | `"VirtualNetworkInherited"` | no |
| default\_action | Specifies the default action of allow or deny when no other rules match. Valid options are Deny or Allow. | `string` | `""` | no |
| delete | Used when deleting the Resource Group. | `string` | `"60m"` | no |
| delete\_data\_disks\_on\_termination | Should the Data Disks (either the Managed Disks / VHD Blobs) be deleted when the Virtual Machine is destroyed? Defaults to false. | `bool` | `true` | no |
| delete\_os\_disk\_on\_termination | Should the OS Disk (either the Managed Disk / VHD Blob) be deleted when the Virtual Machine is destroyed? Defaults to false. | `bool` | `true` | no |
| disable\_password\_authentication | Specifies whether password authentication should be disabled. | `bool` | `true` | no |
| disk\_size\_gb | Specifies the size of the OS Disk in gigabytes. | `number` | `8` | no |
| dns\_servers | List of IP addresses of DNS servers. | `list(string)` | `[]` | no |
| domain\_name\_label | Label for the Domain Name. Will be used to make up the FQDN. If a domain name label is specified, an A DNS record is created for the public IP in the Microsoft Azure DNS system. | `string` | `null` | no |
| enable\_accelerated\_networking | Should Accelerated Networking be enabled? Defaults to false. | `bool` | `false` | no |
| enable\_automatic\_upgrades | Are automatic updates enabled on this Virtual Machine? Defaults to false. | `bool` | `false` | no |
| enable\_https\_traffic\_only | Boolean flag which forces HTTPS if enabled. Defaults to true. | `bool` | `true` | no |
| enable\_ip\_forwarding | Should IP Forwarding be enabled? Defaults to false. | `bool` | `false` | no |
| enabled | Flag to control the module creation. | `bool` | `false` | no |
| environment | Environment (e.g. `prod`, `dev`, `staging`). | `string` | `""` | no |
| error\_404\_document | The absolute path to a custom webpage that should be used when a request is made which does not correspond to an existing file. | `string` | `""` | no |
| exposed\_headers | A list of response headers that are exposed to CORS clients. | `list(any)` | `[]` | no |
| file\_path | The Public SSH Key which should be written to the path defined above. | `string` | `"~/.ssh/id_rsa.pub"` | no |
| hour\_metrics\_enabled | Indicates whether hour metrics are enabled for the Queue service. | `bool` | `false` | no |
| identity\_enabled | Whether identity block is enabled. | `bool` | `false` | no |
| identity\_ids | Specifies a list of user managed identity ids to be assigned to the VM. | `list(any)` | `[]` | no |
| idle\_timeout\_in\_minutes | Specifies the timeout for the TCP idle connection. The value can be set between 4 and 60 minutes. | `number` | `10` | no |
| image\_offer | Specifies the offer of the image used to create the virtual machine. | `string` | `""` | no |
| image\_publisher | Specifies the publisher of the image used to create the virtual machine. | `string` | `""` | no |
| image\_sku | Specifies the SKU of the image used to create the virtual machine. | `string` | `""` | no |
| image\_uri | Specifies the Image URI in the format publisherName:offer:skus:version. This field can also specify the VHD uri of a custom VM image to clone. When cloning a Custom (Unmanaged) Disk Image the os\_type field must be set. | `string` | `""` | no |
| image\_version | Specifies the version of the image used to create the virtual machine. | `string` | `""` | no |
| include\_apis | Indicates whether metrics should generate summary statistics for called API operations. | `bool` | `false` | no |
| index\_document | The webpage that Azure Storage serves for requests to the root of a website or any subfolder. For example, index.html. The value is case-sensitive. | `string` | `""` | no |
| internal\_dns\_name\_label | The (relative) DNS Name used for internal communications between Virtual Machines in the same Virtual Network. | `string` | `null` | no |
| ip\_version | The IP Version to use, IPv6 or IPv4. | `string` | `""` | no |
| is\_hns\_enabled | Is Hierarchical Namespace enabled?. | `bool` | `false` | no |
| label\_order | Label order, e.g. `name`,`application`. | `list(any)` | `[]` | no |
| license\_type | Specifies the BYOL Type for this Virtual Machine. This is only applicable to Windows Virtual Machines. Possible values are Windows\_Client and Windows\_Server. | `string` | `"Windows_Client"` | no |
| linux\_enabled | Whether linux block is enabled. | `bool` | `false` | no |
| location | Location where resource should be created. | `string` | `""` | no |
| log\_delete | Indicates whether all delete requests should be logged. | `bool` | `false` | no |
| log\_read | Indicates whether all read requests should be logged. | `bool` | `false` | no |
| log\_version | The version of storage analytics to configure. | `string` | `""` | no |
| log\_write | Indicates whether all write requests should be logged. | `bool` | `false` | no |
| lun | Specifies the logical unit number of the data disk. This needs to be unique within all the Data Disks on the Virtual Machine. | `number` | `0` | no |
| machine\_count | Number of Virtual Machines to create. | `number` | `0` | no |
| managed | Specifies whether the availability set is managed or not. Possible values are true (to specify aligned) or false (to specify classic). Default is true. | `bool` | `true` | no |
| managed\_disk\_id | Specifies the ID of an existing Managed Disk which should be attached as the OS Disk of this Virtual Machine. If this is set then the create\_option must be set to Attach. | `string` | `""` | no |
| managed\_disk\_type | Specifies the type of Managed Disk which should be created. Possible values are Standard\_LRS, StandardSSD\_LRS or Premium\_LRS. | `string` | `""` | no |
| managedby | ManagedBy, eg 'CloudDrove' or 'AnmolNagpal'. | `string` | `"anmol@clouddrove.com"` | no |
| max\_age\_in\_seconds | The number of seconds the client should cache a preflight response. | `number` | `60` | no |
| minute\_metrics\_enabled | Indicates whether minute metrics are enabled for the Queue service. | `bool` | `false` | no |
| name | Name  (e.g. `app` or `cluster`). | `string` | `""` | no |
| network\_interface\_sg\_enabled | Whether network interface security group is enabled. | `bool` | `false` | no |
| network\_rules\_enabled | Whether network rules block is enabled. | `bool` | `false` | no |
| network\_security\_group\_id | The ID of the Network Security Group which should be attached to the Network Interface. | `string` | `""` | no |
| os\_profile\_enabled | Whether os profile block is enabled. | `bool` | `false` | no |
| os\_type | Specifies the Operating System on the OS Disk. Possible values are Linux and Windows. | `string` | `""` | no |
| pass | Specifies the name of the pass that the content applies to. The only allowable value is oobeSystem. | `string` | `"oobeSystem"` | no |
| plan\_enabled | Whether plan block is enabled. | `bool` | `false` | no |
| plan\_name | Specifies the name of the image from the marketplace. | `string` | `""` | no |
| plan\_product | Specifies the product of the image from the marketplace. | `string` | `""` | no |
| plan\_publisher | Specifies the publisher of the image. | `string` | `""` | no |
| platform\_fault\_domain\_count | Specifies the number of fault domains that are used. Defaults to 3. | `number` | `3` | no |
| platform\_update\_domain\_count | Specifies the number of update domains that are used. Defaults to 5. | `number` | `5` | no |
| primary | Is this the Primary IP Configuration? Must be true for the first ip\_configuration when multiple are specified. Defaults to false. | `bool` | `false` | no |
| private\_ip\_address\_allocation | The allocation method used for the Private IP Address. Possible values are Dynamic and Static. | `string` | `"Static"` | no |
| private\_ip\_address\_version | The IP Version to use. Possible values are IPv4 or IPv6. Defaults to IPv4. | `string` | `"IPv4"` | no |
| private\_ip\_addresses | The Static IP Address which should be used. | `list(any)` | `[]` | no |
| protocol | Specifies the protocol of listener. Possible values are HTTP or HTTPS. | `string` | `""` | no |
| provision\_vm\_agent | Should the Azure Virtual Machine Guest Agent be installed on this Virtual Machine? Defaults to false. | `bool` | `false` | no |
| proximity\_placement\_group\_id | The ID of the Proximity Placement Group to which this Virtual Machine should be assigned. | `string` | `""` | no |
| public\_ip\_enabled | Whether public IP is enabled. | `bool` | `false` | no |
| public\_ip\_prefix\_id | If specified then public IP address allocated will be provided from the public IP prefix resource. | `string` | `null` | no |
| public\_key | Name  (e.g. `ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD3F6tyPEFEzV0LX3X8BsXdMsQ`). | `string` | `""` | no |
| queue\_properties\_enabled | Whether queue properties is enabled. | `bool` | `false` | no |
| read | Used when retrieving the Resource Group. | `string` | `"5m"` | no |
| repository | Terraform current module repo | `string` | `""` | no |
| resource\_group\_name | The name of the resource group in which to create the virtual network. | `string` | `""` | no |
| retention\_policy\_days | Specifies the number of days that logs will be retained. | `number` | `7` | no |
| reverse\_fqdn | A fully qualified domain name that resolves to this public IP address. If the reverseFqdn is specified, then a PTR DNS record is created pointing from the IP address in the in-addr.arpa domain to the reverse FQDN. | `string` | `""` | no |
| sa\_type | Specifies the identity type of the Storage Account. At this time the only allowed value is SystemAssigned. | `string` | `"SystemAssigned"` | no |
| setting\_name | Specifies the name of the setting to which the content applies. Possible values are: FirstLogonCommands and AutoLogon. | `string` | `""` | no |
| sku | The SKU of the Public IP. Accepted values are Basic and Standard. Defaults to Basic. | `string` | `"Basic"` | no |
| source\_vault\_id | Specifies the ID of the Key Vault to use. | `string` | `""` | no |
| static\_website\_enabled | Whether static website block is enabled. | `bool` | `false` | no |
| storage\_data\_disk\_enabled | Whether storage data disk is enabled. | `bool` | `false` | no |
| storage\_image\_reference\_enabled | Whether storage image reference is enabled. | `bool` | `false` | no |
| subnet\_id | The ID of the Subnet where this Network Interface should be located in. | `list(any)` | `[]` | no |
| tags | Additional tags (e.g. map(`BusinessUnit`,`XYZ`). | `map(any)` | `{}` | no |
| timezone | Specifies the time zone of the virtual machine. | `string` | `""` | no |
| ultra\_ssd\_enabled | Should Ultra SSD disk be enabled for this Virtual Machine?. | `bool` | `false` | no |
| update | Used when updating the Resource Group. | `string` | `"60m"` | no |
| use\_subdomain | Should the Custom Domain Name be validated by using indirect CNAME validation?. | `bool` | `false` | no |
| username | The linux user name. | `string` | `""` | no |
| vault\_enabled | Whether key vault is enabled. | `bool` | `false` | no |
| vhd\_uri | Specifies the URI of the VHD file backing this Unmanaged OS Disk. Changing this forces a new resource to be created. | `string` | `null` | no |
| vm\_size | Specifies the size of the Virtual Machine. | `string` | `""` | no |
| vm\_type | The Managed Service Identity Type of this Virtual Machine. Possible values are SystemAssigned and UserAssigned. | `string` | `""` | no |
| windows\_enabled | Whether windows block is enabled. | `bool` | `false` | no |
| write\_accelerator\_enabled | Specifies if Write Accelerator is enabled on the disk. This can only be enabled on Premium\_LRS managed disks with no caching and M-Series VMs. Defaults to false. | `bool` | `false` | no |
| zones | A collection containing the availability zone to allocate the Public IP in. | `list(any)` | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| availability\_set\_id | The ID of the Availability Set. |
| network\_interface\_id | The ID of the Network Interface. |
| network\_interface\_private\_ip\_addresses | The private IP addresses of the network interface. |
| network\_interface\_sg\_association\_id | The (Terraform specific) ID of the Association between the Network Interface and the Network Interface. |
| public\_ip\_address | The IP address value that was allocated. |
| public\_ip\_id | The Public IP ID. |
| tags | The tags associated to resources. |
| virtual\_machine\_id | The ID of the Virtual Machine. |




## Testing
In this module testing is performed with [terratest](https://github.com/gruntwork-io/terratest) and it creates a small piece of infrastructure, matches the output like ARN, ID and Tags name etc and destroy infrastructure in your AWS account. This testing is written in GO, so you need a [GO environment](https://golang.org/doc/install) in your system. 

You need to run the following command in the testing folder:
```hcl
  go test -run Test
```



## Feedback 
If you come accross a bug or have any feedback, please log it in our [issue tracker](https://github.com/clouddrove/terraform-azure-virtual-machine/issues), or feel free to drop us an email at [hello@clouddrove.com](mailto:hello@clouddrove.com).

If you have found it worth your time, go ahead and give us a ★ on [our GitHub](https://github.com/clouddrove/terraform-azure-virtual-machine)!

## About us

At [CloudDrove][website], we offer expert guidance, implementation support and services to help organisations accelerate their journey to the cloud. Our services include docker and container orchestration, cloud migration and adoption, infrastructure automation, application modernisation and remediation, and performance engineering.

<p align="center">We are <b> The Cloud Experts!</b></p>
<hr />
<p align="center">We ❤️  <a href="https://github.com/clouddrove">Open Source</a> and you can check out <a href="https://github.com/clouddrove">our other modules</a> to get help with your new Cloud ideas.</p>

  [website]: https://clouddrove.com
  [github]: https://github.com/clouddrove
  [linkedin]: https://cpco.io/linkedin
  [twitter]: https://twitter.com/clouddrove/
  [email]: https://clouddrove.com/contact-us.html
  [terraform_modules]: https://github.com/clouddrove?utf8=%E2%9C%93&q=terraform-&type=&language=
